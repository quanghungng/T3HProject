<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<title>Divisima | eCommerce Template</title>
	<meta charset="UTF-8">
	<meta name="description" content=" Divisima | eCommerce Template">
	<meta name="keywords" content="divisima, eCommerce, creative, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Favicon -->
	<link href="img/favicon.ico" rel="shortcut icon"/>

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css?family=Josefin+Sans:300,300i,400,400i,700,700i" rel="stylesheet">


	<!-- Stylesheets -->
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}"/>
	<link rel="stylesheet" th:href="@{/css/font-awesome.min.css}"/>
	<link rel="stylesheet" th:href="@{/css/flaticon.css}"/>
	<link rel="stylesheet" th:href="@{/css/slicknav.min.css}"/>
	<link rel="stylesheet" th:href="@{/css/jquery-ui.min.css}"/>
	<link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}"/>
	<link rel="stylesheet" th:href="@{/css/animate.css}"/>
	<link rel="stylesheet" th:href="@{/css/style.css}"/>


	<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

</head>
<body id="body">
	<!-- Page Preloder -->
	<div id="preloder">
		<div class="loader"></div>
	</div>

	<!-- Header section -->
	<div th:replace="fragments/header :: header"></div>
	<!-- Header section end -->


	<!-- Page info -->
	<div class="page-top-info">
		<div class="container">
			<h4>CAtegory PAge</h4>
			<div class="site-pagination">
				<a href="/index">Home</a> /
				<a href="">Shop</a> /
			</div>
		</div>
	</div>
	<!-- Page info end -->


	<!-- Category section -->
	<section class="category-section spad">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 order-2 order-lg-1">
					<div class="filter-widget">
						<h2 class="fw-title">Categories</h2>
						<ul class="category-menu">
							<li><a href="#" type="button" onclick="changeCategory('all')" >All </a>
							<li><a href="#">Woman wear</a>
								<ul id="list-woman" class="sub-menu">
									<li><a href="#">Midi Dresses <span>(2)</span></a></li>
									<li><a href="#">Maxi Dresses<span>(56)</span></a></li>
									<li><a href="#">Prom Dresses<span>(36)</span></a></li>
									<li><a href="#">Little Black Dresses <span>(27)</span></a></li>
									<li><a href="#">Mini Dresses<span>(19)</span></a></li>
								</ul>
							</li>
							<li><a href="#">Man Wear</a>
								<ul id="list-man" class="sub-menu">
									<li><a href="#">Midi Dresses <span>(2)</span></a></li>
									<li><a href="#">Maxi Dresses<span>(56)</span></a></li>
									<li><a href="#">Prom Dresses<span>(36)</span></a></li>
								</ul></li>
							<li><a href="#">Children</a>
								<ul id="list-children" class="sub-menu">
									<li><a href="#">Midi Dresses <span>(2)</span></a></li>
									<li><a href="#">Maxi Dresses<span>(56)</span></a></li>
									<li><a href="#">Prom Dresses<span>(36)</span></a></li>
								</ul></li>
						</ul>
					</div>
					<div class="filter-widget">
						<h2 class="fw-title">Brand</h2>
						<ul class="category-menu">
							<li><a href="#">Abercrombie & Fitch <span>(2)</span></a></li>
							<li><a href="#">Asos<span>(56)</span></a></li>
							<li><a href="#">Bershka<span>(36)</span></a></li>
							<li><a href="#">Missguided<span>(27)</span></a></li>
							<li><a href="#">Zara<span>(19)</span></a></li>
						</ul>
					</div>
					<div class="filter-widget mb-0">
						<h2 class="fw-title">refine by</h2>
						<div class="price-range-wrap">
							<h4>Price</h4>
                            <div class="price-range ui-slider ui-corner-all ui-slider-horizontal ui-widget ui-widget-content" data-min="10" data-max="270">
								<div class="ui-slider-range ui-corner-all ui-widget-header" style="left: 0%; width: 100%;"></div>
								<span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default" style="left: 0%;">
								</span>
								<span tabindex="0" class="ui-slider-handle ui-corner-all ui-state-default" style="left: 100%;">
								</span>
							</div>
							<div class="range-slider">
                                <div class="price-input">
                                    <input type="text" id="minamount">
                                    <input type="text" id="maxamount">
                                </div>
                            </div>
                        </div>
					</div>
					<div class="filter-widget mb-0">
						<h2 class="fw-title">color by</h2>
						<div class="fw-color-choose">
							<div class="cs-item">
								<input type="radio" name="cs" id="gray-color">
								<label class="cs-gray" for="gray-color">
									<span>(3)</span>
								</label>
							</div>
							<div class="cs-item">
								<input type="radio" name="cs" id="orange-color">
								<label class="cs-orange" for="orange-color">
									<span>(25)</span>
								</label>
							</div>
							<div class="cs-item">
								<input type="radio" name="cs" id="yollow-color">
								<label class="cs-yollow" for="yollow-color">
									<span>(112)</span>
								</label>
							</div>
							<div class="cs-item">
								<input type="radio" name="cs" id="green-color">
								<label class="cs-green" for="green-color">
									<span>(75)</span>
								</label>
							</div>
							<div class="cs-item">
								<input type="radio" name="cs" id="purple-color">
								<label class="cs-purple" for="purple-color">
									<span>(9)</span>
								</label>
							</div>
							<div class="cs-item">
								<input type="radio" name="cs" id="blue-color" checked="">
								<label class="cs-blue" for="blue-color">
									<span>(29)</span>
								</label>
							</div>
						</div>
					</div>
					<div class="filter-widget mb-0">
						<h2 class="fw-title">Size</h2>
						<div class="fw-size-choose">
							<div class="sc-item">
								<input type="radio" name="sc" id="xs-size">
								<label for="xs-size">XS</label>
							</div>
							<div class="sc-item">
								<input type="radio" name="sc" id="s-size">
								<label for="s-size">S</label>
							</div>
							<div class="sc-item">
								<input type="radio" name="sc" id="m-size"  checked="">
								<label for="m-size">M</label>
							</div>
							<div class="sc-item">
								<input type="radio" name="sc" id="l-size">
								<label for="l-size">L</label>
							</div>
							<div class="sc-item">
								<input type="radio" name="sc" id="xl-size">
								<label for="xl-size">XL</label>
							</div>
							<div class="sc-item">
								<input type="radio" name="sc" id="xxl-size">
								<label for="xxl-size">XXL</label>
							</div>
						</div>
					</div>
				</div>

				<div class="col-lg-9  order-1 order-lg-2 mb-5 mb-lg-0">
					<div id="list-product" class="row">

					</div>
<!--					<div class="text-center w-100 pt-3">-->
<!--						<button class="site-btn sb-line sb-dark">LOAD MORE</button>-->
<!--					</div>-->
					<nav aria-label="...">
						<ul class="pagination" id="pagination">

						</ul>
					</nav>
				</div>
			</div>
		</div>
		<button onclick="testAnimation()" type="button"></button>
	</section>
	<!-- Category section end -->


	<!-- Footer section -->
	<div th:replace="fragments/footer :: footer"></div>
	<!-- Footer section end -->





	<!--====== Javascripts & Jquery ======-->
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.slicknav.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/jquery.nicescroll.min.js"></script>
	<script src="js/jquery.zoom.min.js"></script>
	<script src="js/jquery-ui.min.js"></script>
	<script src="js/main.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

	<script>
		removeAnimate();
		var cartID = 1;
		var currentCategory = "all";
		const formatter = new Intl.NumberFormat('en-US', {
			style: 'currency',
			currency: 'VND',
			minimumFractionDigits: 0
		})
		function renderDataPage(page, data) {
			loadAnimation();
			$('#list-product').empty();
			console.log(data);
			if(data == null){
				removeAnimate();
				return;
			}
			for (let i = productPerPage * (page - 1); i < Math.min(total, productPerPage * (page - 1) + productPerPage); i++) {
				$('#list-product').append(`<div class="col-lg-4 col-sm-6">
<div class="product-item">
<div class="item pi-pic">
<img src="./img/product/${data[i].image%11 +1}.jpg" alt="">
<div class="pi-links">
<a onclick="addSingleProductToCart(${data[i].id})" href="#" class="add-card"><i class="flaticon-bag"></i><span >ADD TO CART</span></a>
<a onclick="" href="#" class="add-card"><i class="flaticon-heart"></i> <span >ADD TO WISH</span></a>
<a onclick="viewProductDetail(${data[i].id})" href="#" class="add-card"><i class="flaticon-target"></i> <span >VIEW DETAIL</span></a>
</div>
</div>
<div class="pi-text">
<h6>$ ${data[i].price}</h6>
<p>${data[i].name}</p>
</div>
</div>
</div>`)
			}
			removeAnimate();
		}
		var total;
		var productPerPage = 9;
		var page;
		var currentPage = 1;
		var categoryType = "";
		$('#keyword-search').on('input', function () {
			currentPage = 1;
			let key = $(this).val();
			loadAllData();
		});

		loadAllData();
		function loadAllData() {
			let name =  $('#keyword-search').val();
			$.ajax({
				url: "http://localhost:8082/api/product/getProductByCategoryAndName" +"?category=" + currentCategory + "&name=" + name + "&categoryType=" + categoryType ,
				success: function (result) {
					$('#pagination').empty();
					console.log("data response", result);
					if (result.code == '00') {
						console.log("Success");
					} else {
						console.log("Notfound");
						$('#list-product').empty();
					}
					if(result.data == null) {
						renderDataPage(1,result.data);
						return;
					}
					total = result.data.length;
					if (total % productPerPage == 0) page = total / productPerPage;
					else {
						page = Math.floor(total / productPerPage) + 1;
					}
					for (let i = 0; i < page; i++) {
						if (i + 1 == currentPage) {
							$('#pagination').append(`<li class="page-item active"><button onclick="changPage(${i + 1})" th:id="page-button-${i + 1}" class="btn btn-dark">${i + 1}</button></li>`);
						} else
							$('#pagination').append(`<li class="page-item"><button onclick="changPage(${i + 1})" th:id="page-button-${i + 1}" class="btn btn-outline-dark">${i + 1}</button></li>`);
					}
					renderDataPage(currentPage, result.data);
				}
			})
		}
		function changPage(page) {
			currentPage = page;
			loadAllData();
		}
		loadCategory();
		function loadCategory(){
			$.ajax({
				url: "http://localhost:8082/api/product/getCategory",
				success: function (result) {
					console.log("data response", result);
					if (result.code == '00') {
						$('#list-woman').empty();
						$('#list-man').empty();
						$('#list-children').empty();
						for(let i = 0; i < result.data.length; i++){
							if(result.data[i].categoryType == "Woman"){
								$('#list-woman').append(`<li class="active"><a id="${result.data[i].categoryName}" href="#" type="button" onclick="changeCategory('${result.data[i].categoryName}','${result.data[i].categoryType}')">${result.data[i].categoryName}</a></li>`);
							}
							if(result.data[i].categoryType == "Man" )
									$('#list-man').append(`<li><a href="#" type="button" onclick="changeCategory('${result.data[i].categoryName}','${result.data[i].categoryType}')">${result.data[i].categoryName}</a></li>`);
							if(result.data[i].categoryType == "Children")''
									$('#list-children').append(`<li><a href="#" type="button" onclick="changeCategory('${result.data[i].categoryName}','${result.data[i].categoryType}')">${result.data[i].categoryName}</a></li>`);
						}
					}
					else {
						console.log("Notfound");
					}
				}
			})
		}

		function changeCategory(categoryName, type) {
			$('#keyword-search').val('');
			currentPage = 1;
			categoryType = type;
			currentCategory = categoryName;
		    loadAllData();
		    $(categoryName).css("color","#f51167");
		}

		var userInfo = null;
		var token = getCookie("token");
		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for(var i = 0; i < ca.length; i++) {
				var c = ca[i];
				while (c.charAt(0) == ' ') {
					c = c.substring(1);
				}
				if (c.indexOf(name) == 0) {
					return c.substring(name.length, c.length);
				}
			}
			return "";
		}
		console.log(token);
		getUserInfo();
		function getUserInfo() {
			if(token == ""){
				console.log("Tai khoan chua dang nhap");
			}
			$.ajax({
				url: "http://localhost:8082/apiLogin/getUserInfo",
				data: { signature: token },
				type: "GET",
				beforeSend: function(xhr){xhr.setRequestHeader('token', token);},
				success: function (result) {
					console.log(result);
					if(result.data != null){
						userInfo = result.data;
						console.log(userInfo);
						fillUserInfo();

					}
				}
			})
		}
		function fillUserInfo() {
			$('#icon-login').remove();
			$('#user-name').html("Hi, "+userInfo.name);
			$("#user-info").css("display", "inline-block");
			let numberProductInCart = 0;
			userInfo.cart.listProduct.map(item => {
				numberProductInCart += item.quantity;
			});
			console.log("Number of product in cart: " + numberProductInCart);
			$('#number-product-in-cart').html(numberProductInCart);
		}
		function addSingleProductToCart(productID) {
			token = getCookie("token");
			getUserInfo();
			if(userInfo == null){
				window.location.replace("http://localhost:8082/login");
				return;
			}
			let updateCartRequest = {
				id:productID,
				number: 1,
				type: 1
			};
			$.ajax({
				url:"http://localhost:8082/cart/update/"+userInfo.id,
				data: { signature: token },
				type:"PUT",
				data:JSON.stringify(updateCartRequest),
				contentType: "application/json",
				beforeSend: function(xhr){xhr.setRequestHeader('token', token);},
				success: function (response) {
					console.log(response);
					if(response.code == '00'){
						token = getCookie("token");
						getUserInfo();
						alertify.success('Success add product to cart');
					}
					if(response.code == '404'){
						window.location.replace("http://localhost:8082/login");
					}
				},
				error: function (error) {
					alertify.error('Error');
				}
			})
		}
	function viewProductDetail(productID) {
		sessionStorage.setItem("productID", productID);
		window.location.replace("http://localhost:8082/productDetail");
	}


	</script>

	</body>
</html>
